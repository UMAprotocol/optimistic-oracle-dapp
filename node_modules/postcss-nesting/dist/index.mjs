import e from"postcss-selector-parser";function t(e){const t=e.parent,n=t.index(e);return n&&t.cloneBefore().removeAll().append(t.nodes.slice(0,n)),t.before(e),t}function n(e){e.nodes.length||e.remove()}function r(t,n){let r=!1,o=t.length>1;const p=e().astSync(t.join(",")),s=e().astSync(`:is(${t.join(",")})`);let a=0;return p.walk((e=>{"root"!==e.type&&a++})),a>2&&(r=!0),n.map((t=>e((t=>{t.walkNesting((t=>{if(o)t.replaceWith(s.clone());else{if(t.next()&&"tag"===t.next().type){const n=e.pseudo({value:":is"});return n.append(t.next().clone()),t.next().replaceWith(n),r?void t.replaceWith(s.clone()):void t.replaceWith(p.clone())}if(t.prev()&&"combinator"!==t.prev().type&&p.first&&p.first.first&&"tag"===p.first.first.type){if(r)return void t.replaceWith(s.clone());let n=t.prev();for(;n.prev()&&"combinator"!==n.prev().type;)n=n.prev();if("tag"!==n.type)return t.parent.insertBefore(n,p.clone()),void t.remove();const o=e.pseudo({value:":is"});return o.append(p.clone()),void t.replaceWith(o)}t.replaceWith(p.clone())}}))})).processSync(t)))}const o=e=>{let t=[],n="",r=!1,o=0,p=!1,s=!1;for(let a of e)s?s=!1:"\\"===a?s=!0:p?a===p&&(p=!1):'"'===a||"'"===a?p=a:"("===a?o+=1:")"===a?o>0&&(o-=1):0===o&&","===a&&(r=!0),r?(""!==n&&t.push(n.trim()),n="",r=!1):n+=a;return t.push(n.trim()),t};var p=["container","document","media","supports"];function s(e){const r=t(e);var p,s;e.params=(p=r.params,s=e.params,o(p).map((e=>o(s).map((t=>`${e} and ${t}`)).join(", "))).join(", ")),n(r)}function a(e){e.each((e=>{(e=>"rule"===e.type&&"rule"===Object(e.parent).type&&e.selectors.every((e=>0===e.trim().indexOf("&")&&-1===e.indexOf("|"))))(e)?function(e){const o=t(e);e.selectors=r(o.selectors,e.selectors),("rule"===e.type&&"rule"===o.type&&e.selector===o.selector||"atrule"===e.type&&"atrule"===o.type&&e.params===o.params)&&e.append(...o.nodes),n(o)}(e):(e=>"atrule"===e.type&&"nest"===e.name&&"rule"===Object(e.parent).type&&o(e.params).every((e=>e.split("&").length>=2&&-1===e.indexOf("|"))))(e)?function(e,p){const s=t(e),a=s.clone().removeAll().append(e.nodes);e.replaceWith(a),a.selectors=r(s.selectors,o(e.params)),n(s),p(a)}(e,a):(e=>"atrule"===e.type&&p.includes(e.name)&&"rule"===Object(e.parent).type)(e)?function(e,r){const o=t(e),p=o.clone().removeAll().append(e.nodes);e.append(p),n(o),r(p)}(e,a):(e=>"atrule"===e.type&&p.includes(e.name)&&"atrule"===Object(e.parent).type&&e.name===e.parent.name)(e)&&s(e),Object(e.nodes).length&&a(e)}))}function c(){return{postcssPlugin:"postcss-nesting",Rule(e){a(e)}}}c.postcss=!0;export{c as default};
//# sourceMappingURL=index.mjs.map
