import s from"autoprefixer";import e from"browserslist";import o from"cssdb";import t from"postcss-attribute-case-insensitive";import r from"css-blank-pseudo";import i from"postcss-color-functional-notation";import n from"postcss-color-hex-alpha";import c from"postcss-color-rebeccapurple";import p from"postcss-custom-media";import a from"postcss-custom-properties";import u from"postcss-custom-selectors";import m from"postcss-dir-pseudo-class";import l from"postcss-double-position-gradients";import f from"postcss-env-function";import d from"postcss-focus-visible";import b from"postcss-focus-within";import g from"postcss-font-variant";import $ from"postcss-gap-properties";import y from"css-has-pseudo";import j from"postcss-image-set-function";import w from"postcss-initial";import v from"postcss-lab-function";import O from"postcss-logical";import h from"postcss-media-minmax";import x from"postcss-nesting";import k from"postcss-overflow-shorthand";import S from"postcss-page-break";import P from"postcss-place";import M from"css-prefers-color-scheme";import B from"postcss-pseudo-class-any-link";import q from"postcss-replace-overflow-wrap";import F from"postcss-selector-not";import*as T from"caniuse-lite";import A from"fs";import U from"path";function N(){return{postcssPlugin:"postcss-system-ui-font",Declaration(s){C.test(s.prop)&&(s.value.includes(I.join(", "))||(s.value=s.value.replace(J,R)))}}}N.postcss=!0;const C=/(?:^(?:-|\\002d){2})|(?:^font(?:-family)?$)/i,E="[\\f\\n\\r\\x09\\x20]",I=["system-ui","-apple-system","Segoe UI","Roboto","Ubuntu","Cantarell","Noto Sans","sans-serif"],J=new RegExp(`(^|,|${E}+)(?:system-ui${E}*)(?:,${E}*(?:${I.join("|")})${E}*)?(,|$)`,"i"),R=`$1${I.join(", ")}$2`;var V={"all-property":w,"any-link-pseudo-class":B,"blank-pseudo-class":r,"break-properties":S,"case-insensitive-attributes":t,"color-functional-notation":i,"custom-media-queries":p,"custom-properties":a,"custom-selectors":u,"dir-pseudo-class":m,"double-position-gradients":l,"environment-variables":f,"focus-visible-pseudo-class":d,"focus-within-pseudo-class":b,"font-variant-property":g,"gap-properties":$,"has-pseudo-class":y,"hexadecimal-alpha-notation":n,"image-set-function":j,"lab-function":v,"logical-properties-and-values":O,"media-query-ranges":h,"nesting-rules":x,"not-pseudo-class":F,"overflow-property":k,"overflow-wrap-property":q,"place-properties":P,"prefers-color-scheme-query":M,"rebeccapurple-color":c,"system-ui-font-family":N};function D(s,e){return Object.keys(s).map((o=>[].concat(s[o]).map((s=>({[e]:!0,plugin:s,id:o}))))).reduce(((s,e)=>s.concat(e)),[])}var L=["custom-media-queries","custom-properties","environment-variables","image-set-function","media-query-ranges","prefers-color-scheme-query","nesting-rules","custom-selectors","any-link-pseudo-class","case-insensitive-attributes","focus-visible-pseudo-class","focus-within-pseudo-class","matches-pseudo-class","not-pseudo-class","logical-properties-and-values","dir-pseudo-class","all-property","color-functional-notation","double-position-gradients","hexadecimal-alpha-notation","lab-function","rebeccapurple-color","color-mod-function","blank-pseudo-class","break-properties","font-variant-property","has-pseudo-class","gap-properties","overflow-property","overflow-wrap-property","place-properties","system-ui-font-family"];async function z(s,e,o,t){const r=function(s){return`:root {\n${Object.keys(s).reduce(((e,o)=>(e.push(`\t${o}: ${s[o]};`),e)),[]).join("\n")}\n}\n`}(o),i=function(s){return`${Object.keys(s).reduce(((e,o)=>(e.push(`@custom-media ${o} ${s[o]};`),e)),[]).join("\n")}\n`}(e),n=function(s){return`${Object.keys(s).reduce(((e,o)=>(e.push(`@custom-selector ${o} ${s[o]};`),e)),[]).join("\n")}\n`}(t),c=`${i}\n${n}\n${r}`;await W(s,c)}function G(s,e){return`\n\t${s}: {\n${Object.keys(e).reduce(((s,o)=>(s.push(`\t\t'${X(o)}': '${X(e[o])}'`),s)),[]).join(",\n")}\n\t}`}function H(s,e){return`export const ${s} = {\n${Object.keys(e).reduce(((s,o)=>(s.push(`\t'${X(o)}': '${X(e[o])}'`),s)),[]).join(",\n")}\n};\n`}function K(s,e){return Promise.all([].concat(e).map((async e=>{if(e instanceof Function)await e({customMedia:Q(s.customMedia),customProperties:Q(s.customProperties),customSelectors:Q(s.customSelectors)});else{const o=e===Object(e)?e:{to:String(e)},t=o.toJSON||Q;if("customMedia"in o||"customProperties"in o||"customSelectors"in o)o.customMedia=t(s.customMedia),o.customProperties=t(s.customProperties),o.customSelectors=t(s.customSelectors);else if("custom-media"in o||"custom-properties"in o||"custom-selectors"in o)o["custom-media"]=t(s.customMedia),o["custom-properties"]=t(s.customProperties),o["custom-selectors"]=t(s.customSelectors);else{const e=String(o.to||""),r=(o.type||U.extname(o.to).slice(1)).toLowerCase(),i=t(s.customMedia),n=t(s.customProperties),c=t(s.customSelectors);"css"===r&&await z(e,i,n,c),"js"===r&&await async function(s,e,o,t){const r=`module.exports = {${G("customMedia",e)},${G("customProperties",o)},${G("customSelectors",t)}\n};\n`;await W(s,r)}(e,i,n,c),"json"===r&&await async function(s,e,o,t){const r=`${JSON.stringify({"custom-media":e,"custom-properties":o,"custom-selectors":t},null,"  ")}\n`;await W(s,r)}(e,i,n,c),"mjs"===r&&await async function(s,e,o,t){const r=`${H("customMedia",e)}\n${H("customProperties",o)}\n${H("customSelectors",t)}`;await W(s,r)}(e,i,n,c)}}})))}function Q(s){return Object.keys(s).reduce(((e,o)=>(e[o]=String(s[o]),e)),{})}function W(s,e){return new Promise(((o,t)=>{A.writeFile(s,e,(s=>{s?t(s):o()}))}))}function X(s){return s.replace(/\\([\s\S])|(')/g,"\\$1$2").replace(/\n/g,"\\n").replace(/\r/g,"\\r")}const Y=t=>{const r=Object(Object(t).features),i=Object(Object(t).insertBefore),n=Object(Object(t).insertAfter),c=Object(t).browsers,p="stage"in Object(t)?!1===t.stage?5:parseInt(t.stage)||0:2,a=Object(t).autoprefixer,u=Z(Object(t)),m=!1===a?()=>{}:s(Object.assign({overrideBrowserslist:c},a)),l=o.concat(D(i,"insertBefore"),D(n,"insertAfter")).filter((s=>s.insertBefore||s.id in V)).sort(((s,e)=>L.indexOf(s.id)-L.indexOf(e.id)||(s.insertBefore?-1:e.insertBefore?1:0)||(s.insertAfter?1:e.insertAfter?-1:0))).map((s=>{const e=function(s){const e=T.features[s];if(e){const s=T.feature(e).stats;return Object.keys(s).reduce(((e,o)=>e.concat(Object.keys(s[o]).filter((e=>0!==s[o][e].indexOf("y"))).map((s=>`${o} ${s}`)))),[])}return["> 0%"]}(s.caniuse);return s.insertBefore||s.insertAfter?{browsers:e,plugin:s.plugin,id:`${s.insertBefore?"before":"after"}-${s.id}`,stage:6}:{browsers:e,plugin:V[s.id],id:s.id,stage:s.stage}})),f=l.filter((s=>s.id in r?r[s.id]:s.stage>=p)).map((s=>{let e,o;return e=!0===r[s.id]?u?Object.assign({},u):void 0:u?Object.assign({},u,r[s.id]):Object.assign({},r[s.id]),o=s.plugin.postcss?s.plugin(e):s.plugin,{browsers:s.browsers,plugin:o,id:s.id}})),d=e(c,{ignoreUnknownVersions:!0}),b=f.filter((s=>s.id in r?r[s.id]:d.some((o=>e(s.browsers,{ignoreUnknownVersions:!0}).some((s=>s===o)))))).map((s=>s.plugin));return b.push(m),{postcssPlugin:"postcss-preset-env",plugins:b,OnceExit:function(){Object(t).exportTo&&K(u.exportTo,t.exportTo)}}},Z=s=>{if("importFrom"in s||"exportTo"in s||"preserve"in s){const e={};return"importFrom"in s&&(e.importFrom=s.importFrom),"exportTo"in s&&(e.exportTo={customMedia:{},customProperties:{},customSelectors:{}}),"preserve"in s&&(e.preserve=s.preserve),e}return!1};Y.postcss=!0;export{Y as default};
//# sourceMappingURL=index.mjs.map
